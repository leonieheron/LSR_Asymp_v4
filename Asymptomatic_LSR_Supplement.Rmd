---
title: "Supporting Information"
author: "Diana Buitrago-Garcia, Aziz Mert Ipekci, Leonie Heron, Stefanie Hossmann, Hira Imeri, Georgia Salanti, Nicola Low"
date: "`r format(Sys.time(), '%d/%m/%y')`"
output: 
  html_document:
  toc: true
  toc_float: true
  theme: united
  highlight: tango
#always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

###############################################################
# Supplementary material                        ##########
###############################################################

###############################################################
# Question 1: results output                         ##########
# Proportion of asymptomatic cases                   ##########
# Supplementary material: preprints removed          ##########
###############################################################

#load the libraries
library(meta)
library(readxl)
library(tidyverse)
library(httr) # use to retrieve data from REDCap
library(kableExtra)
library(flextable)
library(dplyr)
library(Rcpp)


# Prepare the data
# get the data directly from redcap:
# report #155 is Q1:
url <- "https://redcap.ispm.unibe.ch/api/"
token <- "F2725F15FE84D2832E2793BB23B0A62B"
formData <- list("token"=token,
                 content='report',
                 format='csv',
                 report_id='155',
                 csvDelimiter='',
                 rawOrLabel='raw',
                 rawOrLabelHeaders='raw',
                 exportCheckboxLabel='false',
                 returnFormat='csv'
)
response <- httr::POST(url, body = formData, encode = "form")
asymptomaticQ1_pub <- httr::content(response)


settings=c("Contact investigation",
           "Contact investigation, aggregated",
           "Outbreak investigation",
           "Statistical model",
           "Screening",
           "Hospitalised adults",
           "Hospitalised children",
           "Hospitalised adults & children")


asymptomaticQ1_pub$setting2<-factor(asymptomaticQ1_pub$setting2, levels=1:8, labels=settings)
#combine contact investigation and contact investigation aggregated
asymptomaticQ1_pub$setting2[asymptomaticQ1_pub$setting2 == "Contact investigation, aggregated"] <- "Contact investigation"

# minor cleaning
asymptomaticQ1_pub[asymptomaticQ1_pub==9999]=NA

asymptomaticQ1_pub$setting=asymptomaticQ1_pub$setting2

#remove preprints at time of search
asymptomaticQ1_pub <- asymptomaticQ1_pub %>%
  filter(source != 1 & source != 2)

data_long1_pub <- gather(asymptomaticQ1_pub, cluster, total, c(q1_c1_total,q1_c2_total,q1_c3_total), factor_key=TRUE) %>% 
  mutate(id=1:nrow(.)) %>%
  select(record_id, author_1, setting, total, id, cluster)
data_long2_pub <-gather(asymptomaticQ1_pub, cluster, events, c(q1_c1_event,q1_c2_event,q1_c3_event), factor_key=TRUE) %>% 
  mutate(id=1:nrow(.)) %>%
  select(events, id)

data_Q1_pub = merge(data_long1_pub, data_long2_pub, by="id")
data_Q1_pub = data_Q1_pub[!is.na(data_Q1_pub$total),]
data_Q1_pub$cluster=factor(data_Q1_pub$cluster,labels=c("1","2","3"),levels=c("q1_c1_total","q1_c2_total","q1_c3_total"))

data_Q1_pub[data_Q1_pub$record_id %in% asymptomaticQ1_pub[is.na(asymptomaticQ1_pub$q1_c2_event),]$record_id,]$cluster=NA

asymptomaticQ1_pub=data_Q1_pub

asymptomaticQ1_pub$label=paste0("#", asymptomaticQ1_pub$record_id, " ", asymptomaticQ1_pub$author_1, " (2020)",ifelse(!is.na(asymptomaticQ1_pub$cluster),paste0(" cluster:",asymptomaticQ1_pub$cluster),"")) # [FU: ",asymptomaticQ1$fup_median,"]")

asymptomaticQ1_pub$label=paste0("#", asymptomaticQ1_pub$record_id, " ", asymptomaticQ1_pub$author_1,ifelse(!is.na(asymptomaticQ1_pub$cluster),paste0(" [cluster:",asymptomaticQ1_pub$cluster,"]"),"")) # [FU: ",asymptomaticQ1$fup_median,"]")

#change clusters to descriptions
asymptomaticQ1_pub$label[asymptomaticQ1_pub$label == "#4479 Harada [cluster:1]"] <- "#4479 Harada [Patients]"
asymptomaticQ1_pub$label[asymptomaticQ1_pub$label == "#4479 Harada [cluster:2]"] <- "#4479 Harada [Healthcare workers]"
#asymptomaticQ1$label[asymptomaticQ1$label == "#2826 Taylor [cluster:1]"] <- "#2826 Taylor []" #clarify
#asymptomaticQ1$label[asymptomaticQ1$label == "#2826 Taylor [cluster:2]"] <- "#2826 Taylor []"
asymptomaticQ1_pub$label[asymptomaticQ1_pub$label == "#2892 Kennelly [cluster:1]"] <- "#2892 Kennelly [Nursing home residents]"
asymptomaticQ1_pub$label[asymptomaticQ1_pub$label == "#2892 Kennelly [cluster:2]"] <- "#2892 Kennelly [Nursing home staff]"
asymptomaticQ1_pub$label[asymptomaticQ1_pub$label == "#2802 Bender [cluster:1]"] <- "#2802 Bender [Hospital 1]"
asymptomaticQ1_pub$label[asymptomaticQ1_pub$label == "#2802 Bender [cluster:2]"] <- "#2802 Bender [Hospital 2]"
asymptomaticQ1_pub$label[asymptomaticQ1_pub$label == "#4968 van Buul [cluster:1]"] <- "#4968 van Buul [Nursing home residents]"
asymptomaticQ1_pub$label[asymptomaticQ1_pub$label == "#4968 van Buul [cluster:2]"] <- "#4968 van Buul [Healthcare workers]"
asymptomaticQ1_pub$label[asymptomaticQ1_pub$label == "#5273 Theuring [cluster:1]"] <- "#5273 Theuring [School students and staff]"
asymptomaticQ1_pub$label[asymptomaticQ1_pub$label == "#5273 Theuring [cluster:2]"] <- "#5273 Theuring [Household members]"


data_pub=asymptomaticQ1_pub[order(asymptomaticQ1_pub$setting,1/(1/asymptomaticQ1_pub$events+1/(asymptomaticQ1_pub$total-asymptomaticQ1_pub$events))),]

data_pub[is.na(data_pub$setting),]$record_id
data_pub=data_pub[!is.na(data_pub$setting),]

asym_plot<-metaprop(events,total,data=data_pub,sm = "PLOGIT", studlab=label, 
                    byvar=setting,# tau.common =TRUE,
                    prediction = TRUE,
                    control=list(stepadj=0.05, maxiter=10000))#, method ="INV") #, verbose=TRUE, digits=5, control=list(stepadj=0.5))

asym_plot

png(file = 'forest_meta_Q1_published.png',width = 30,height = 60, res=600, units="cm") 

forest(asym_plot,  col.square=data_pub$setting, sortvar = 1/seTE,
       #squaresize = 1/(1/data$events+1/(data$total-data$events)),
       #sortvar = 1/(1/events+1/(total-events)), 
       subgroup=TRUE, 
       just.studlab="left", colgap.studlab="2cm",
       #leftcols = c("label", "setting", "age", "design", "asym_denom"),
       #leftcols=c("studlab", "record_id", "event", "n"),
       xlab = "",just="left",comb.random=TRUE,test.subgroup.random=FALSE,
       comb.fixed=FALSE,test.subgroup.fixed=FALSE, predict=T)#, study.results=TRUE,test.subgroup=TRUE)
dev.off()

###############################################################
# Countries included in Q1                           ##########
###############################################################


Q1_table_countries <- httr::content(response)

#clean countries
Q1_table_countries <- Q1_table_countries %>%
  mutate(country = ifelse(country == 10, "Australia", country),
         country = ifelse(country == 11, "Austria", country),
         country = ifelse(country == 15, "Bahrain", country),
         country = ifelse(country == 19, "Belgium", country),
         country = ifelse(country == 28, "Brunei", country),
         country = ifelse(country == 34, "Canada", country),
         country = ifelse(country == 40, "China", country),
         country = ifelse(country == 41, "Colombia", country),
         country = ifelse(country == 51, "Denmark", country),
         country = ifelse(country == 62, "France", country),
         country = ifelse(country == 63, "French Guyana", country),
         country = ifelse(country == 67, "Germany", country),
         country = ifelse(country == 69, "Greece", country),
         country = ifelse(country == 78, "Iceland", country),
         country = ifelse(country == 79, "India", country),
         country = ifelse(country == 83, "Ireland", country),
         country = ifelse(country == 85, "Italy", country),
         country = ifelse(country == 87, "Japan", country),
         country = ifelse(country == 92, "Kuwait", country),
         country = ifelse(country == 105, "Malaysia", country),
         country = ifelse(country == 121, "Netherlands", country),
         country = ifelse(country == 128, "Norway", country),
         country = ifelse(country == 888, "Other", country),
         country = ifelse(country == 138, "Portugal", country),
         country = ifelse(country == 146, "Saudi Arabia", country),
         country = ifelse(country == 157, "South Korea", country),
         country = ifelse(country == 160, "Spain", country),
         country = ifelse(country == 174, "Turkey", country),
         country = ifelse(country == 176, "Uganda", country),
         country = ifelse(country == 180, "United Kingdom", country),
         country = ifelse(country == 181, "United States of America", country),
         country = ifelse(country == 185, "Vietnam", country))

#clean case numbers
#total SARS-CoV-2 n
Q1_table_countries$q1_c1_total[is.na(Q1_table_countries$q1_c1_total)] <- 0
Q1_table_countries$q1_c2_total[is.na(Q1_table_countries$q1_c2_total)] <- 0
Q1_table_countries$q1_c1_event[is.na(Q1_table_countries$q1_c1_event)] <- 0
Q1_table_countries$q1_c2_event[is.na(Q1_table_countries$q1_c2_event)] <- 0

Q1_table_countries$total_SARS_n <- Q1_table_countries$q1_c1_total + Q1_table_countries$q1_c2_total
Q1_table_countries$asymp_SARS_n <- Q1_table_countries$q1_c1_event + Q1_table_countries$q1_c2_event

#remove unnecessary cols
Q1_table_countries <- Q1_table_countries %>%
  select(country, total_SARS_n, asymp_SARS_n)

#group by countries to calculate n, total cases, total asymp cases
Q1_table_countries <- Q1_table_countries %>%
  group_by(country) %>%
  summarise(total_SARS = sum(total_SARS_n),
            total_asymp_SARS = sum(asymp_SARS_n),
            n = n())

#arrange by number of studies
Q1_table_countries <- Q1_table_countries %>%
  arrange(desc(n))

```

## PRISMA 2020 Checklist
*Shiny app can be used to complete checklist here:* <https://prisma.shinyapps.io/checklist/>

***

## Search strings

From: Living Evidence on COVID-19 (<https://ispmbern.github.io/covid-19/living-review/collectingdata.html>, accessed 31.01.2021)

We retrieve data from [EMBASE](http://www.embase.com/) via OVID, [MEDLINE](https://www.ncbi.nlm.nih.gov/pubmed/) via PubMed, BioRxiv and MedRxiv.

**Search terms**

When searches are updated, references that are identified that were not in the database before, are inserted by date (**date_entrez**) they were indexed in remote database, the date they are inserted in OUR database is formatted as the ‘**strategydate**’ (raw data is available [here](https://github.com/leonieheron/LSRworkflow>)).

**30.10.2020**

EMBASE:

(exp SARS-related coronavirus/ or severe acute respiratory syndrome/ or coronavirus disease 2019/ or (coronavir* or corona virus* or HCoV* or ncov* or 2019 cov or covid or covid19 or sars-cov* or sarscov* or sars-coronavirus* or Severe Acute Respiratory Syndrome Coronavirus* or nCoV).mp.) and 20191101:20301231.(dc).

MEDLINE:

("severe acute respiratory syndrome coronavirus 2"[Supplementary Concept] OR "COVID-19" [Supplementary Concept] OR "coronavirus" OR "corona virus" OR "HCoV" OR "nCoV" OR "2019 CoV" OR "covid" OR "covid19" OR "Severe Acute Respiratory Syndrome Coronavirus 2" OR "SARS-CoV2" OR "SARS-CoV 2" OR "SARS Coronavirus 2") AND (2019/11/01:3000/12/31[PDAT])

**01.05.2021**

EMBASE:

(SARS coronavirus/ or middle east respiratory syndrome/ or severe acute respiratory syndrome/ or (coronavirus* or corona virus* or HCoV* or ncov* or covid or covid19 or sars-cov* or sarscov* or Sars-coronavirus* or Severe Acute Respiratory Syndrome Coronavirus*).mp.) and 20191201:20301231.(dc).

**29.04.2020**

MEDLINE:

("coronavirus"[MH] OR "coronavirus infections"[MH] OR "coronavirus"[TW] OR "corona virus"[TW] OR "HCoV"[TW] OR "nCov"[TW] OR "covid"[TW] OR "covid19"[TW] OR "Severe Acute Respiratory Syndrome Coronavirus 2"[TW] OR "SARS-CoV2"[TW] OR "SARS-CoV 2"[TW] OR "SARS Coronavirus 2"[TW] OR "MERS- CoV"[TW]) AND (2019/1/1:3000[PDAT])

**01.04.2020**

From 01.04.2020, we retrieve the [BioRxiv/MedRxiv dataset](https://connect.medrxiv.org/relate/content/181).

**26.03.2020**

MEDLINE:

("Wuhan coronavirus" [Supplementary Concept] OR "COVID-19" OR SARS-CoV-2 OR "2019 ncov"[tiab] OR (("novel coronavirus"[tiab] OR "new coronavirus"[tiab]) AND (wuhan[tiab] OR 2019[tiab])) OR 2019-nCoV[All Fields] OR (wuhan[tiab] AND coronavirus[tiab]))

EMBASE:

(nCoV or 2019-nCoV or ((new or novel or wuhan) adj3 coronavirus) or covid19 or covid-19 or SARS-CoV-2).mp.

BioRxiv/MedRxiv:

ncov or corona or wuhan or COVID or SARS-CoV-2
 
With the kind support of the [Public Health & Primary Care Library PHC](https://www.unibe.ch/university/services/university_library/faculty_libraries/medicine/public_health_amp_primary_care_library_phc/index_eng.html), and following guidance of the [Medical Library Association](https://www.mlanet.org/p/cm/ld/fid%3D1713)

**01.01.2020**

MEDLINE:

("Wuhan coronavirus" [Supplementary Concept] OR "COVID-19" OR "2019 ncov"[tiab] OR (("novel coronavirus"[tiab] OR "new coronavirus"[tiab]) AND (wuhan[tiab] OR 2019[tiab])) OR 2019-nCoV[All Fields] OR (wuhan[tiab] AND coronavirus[tiab])))))

EMBASE:

ncov OR (wuhan AND corona) OR COVID

BioRxiv/MedRxiv:

ncov or corona or wuhan or COVID

We retained publications that used the keywords listed below in the title or abstract.

"asymp*" OR "pre-symp*" OR "presymp*" OR "preclinical" OR "pre-clinical" OR "without symptoms" OR "no symptoms" OR "free of symptoms" OR "non-symp*" OR "nonsymp*" OR "symptom-free" OR "symptomfree"

***

## Flowchart
*In progress.*

***

## Risk of bias in studies included in review question 1 and review question 2.
*In progress.*

***

## Review question 1, subgroup analysis comparing studies of hospitalised patients with all other settings.
*Sub-group analysis to be decided*

***

## Review question 1, sensitivity analysis, omitting studies that were preprints at the time of literature search.
![Figure 3. Review question 1, sensitivity analysis, omitting studies that were preprints at the time of literature search](forest_meta_Q1_published.png)


***

## Assessment of credibility of mathematical modelling studies.
*In progress.*

***

## Types of study included in successive versions of the living systematic review, as of 10 June 2020.
*Settings to be reviewed. Some studies have been reclassified into different settings.*

***

## Location of studies contributing data to review questions 1 and 2.1.

```{r table1, ft.split=TRUE, tab.cap='Table 1. Location of studies contributing data to review questions 1', echo = FALSE}
table1_countries <- flextable(Q1_table_countries)

table1_countries %>% 
  set_header_labels(country = "Country",
                    total_SARS = "Total SARS-CoV-2, n",
                    total_asymp_SARS = "Total asymptomatic SARS-CoV-2, n",
                    n = "Total number of studies") %>%
  set_table_properties(layout = "autofit") %>%
  theme_vanilla()
```

*Table 2 in progress.*


